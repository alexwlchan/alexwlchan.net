<entry>
  <title type="html">{{ post.title | smartify | strip_html | normalize_whitespace | xml_escape }}{% if post.link %} &amp;rarr;{% endif %}</title>
  <link
    href="{% if post.link %}{{ post.link }}{% else %}{{ post.url | absolute_url }}?utm_source=rss{% endif %}"
    rel="alternate"
    type="text/html"
    title="{{ post.title | strip_html | xml_escape }}"
  />
  <published>{{ post.date | date_to_xmlschema }}</published>
  <updated>{{ post.last_modified_at | default: post.date | date_to_xmlschema }}</updated>

  {% comment %}
    This makes the post URL the permalink for new posts.
    
    Previously it was the post ID, which doesn't have the trailing slash.
    
    To avoid resending old posts to everyone's RSS readers, I'm preserving
    the sans-slash IDs.  When all the posts without slashes fall off the end,
    I can remove this workaround.
    
    See https://github.com/alexwlchan/alexwlchan.net/issues/787
  {% endcomment %}
  {% capture post_date %}{{ post.date | date: '%s' }}{% endcapture %}
  {% if post_date > '1716643270' %}
  <id>{{ post.url | absolute_url | xml_escape }}</id>
  {% else %}
  <id>{{ post.id | absolute_url | xml_escape }}</id>
  {% endif %}

  <content type="html" xml:base="{{ post.url | absolute_url | xml_escape }}">
    <![CDATA[
    {{- post.content | cleanup_text | strip | fix_html_for_feed_readers | fix_youtube_iframes }}

    <p>[If the formatting of this post looks odd in your feed reader, <a href="{{ post.url | absolute_url | xml_escape }}">visit the original article</a>]</p>
    ]]>
  </content>

  {% for tag in post.tags %}
    <category term="{{ tag | xml_escape }}" />
  {% endfor %}

  {% if post.summary %}
    <summary type="html">{{ post.summary | strip_html | normalize_whitespace | xml_escape }}</summary>
  {% endif %}
</entry>
