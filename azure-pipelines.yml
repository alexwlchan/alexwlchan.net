trigger:
- "master"

pr:
- "master"

pool:
  vmImage: "Ubuntu-16.04"

jobs:
- job: "Build"

  steps:
  - script: "make build"

- job: "Deploy"
  dependsOn: "Build"
  condition: "eq(variables['Build.SourceBranch'], 'refs/heads/master')"

  steps:
  - displayName: "Deploy files to Linode"
    script: "make deploy"

  - displayName: "Push any new commits to GitHub"
    script: |
      git config --global user.name "Azure Pipelines on behalf of Alex Chan"
      git config --global user.email "azurepipelines_git@alexwlchan.fastmail.co.uk"
      # git config core.sshCommand "ssh -i id_rsa"
      git remote add ssh-origin git@github.com:alexwlchan/alexwlchan.net.git

      git push ssh-origin HEAD:master
